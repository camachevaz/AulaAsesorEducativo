---
title: Хранение данных аудита
sidebar: ember-flexberry-security_sidebar
keywords: Flexberry Audit, БД
toc: true
permalink: ru/efs_audit-data-storage.html
lang: ru
---

# Хранение данных аудита

Для хранения данных аудита можно использовать структуру, аналогичную представленной ниже (такую структуру возможно использовать вне базы данных приложения; названия соответствующих таблиц будут иметь префикс STORM). Данная структура для хранения используется в реализации [ICSSoft.STORMNET.Business.Audit.Audit интерфейса IAudit](efs_i-audit.html).

![Изображение](/images/img/page/AuditWeb/AuditStoreStructure.PNG)

* Классы `Agent` и `LinkGroup` – классы из [подсистемы полномочий](efs_security.html).

* `AuditEntity` – сведения об аудируемом событии над объектом (аналогичный класс использовался в [старом аудите (`АудитОперации`)](efs_audit.html))
** `ObjectPrimaryKey` – [первичный ключ объекта](fo_primary-keys-objects.html), над которым была выполнена аудируемая операция.
** `OperationTime` – время, когда над объектом была выполнена аудируемая операция.
** `OperationType` – тип выполненной над объектом аудируемой операции (если была выполнена «стандартная операция», то будет передаваться в виде строки значение из типа `tTypeOfAuditOperation`; если была выполнена нестандартная – имя соответствующей операции).
** `ExecutionResult` – результат выполнения аудируемой операции.
** `Source` – компьютер, откуда была выполнена операция (например, «IP: 192.168.0.5»).
** `SerializedField` – сериализованное представление данных об изменении полей из AuditFields ('''на настоящий момент не используется''').

* `ObjectType` – тип аудируемого объекта.
** `Name` – имя типа объекта (если тип стандартный, то `AssemblyQualifiedName`; если нестандартный – передаваемое пользователем определение).

* `AuditField` – детализация по аудируемому событию над объектом: какие поля и как были изменены (аналогичный класс использовался в [старом аудите(`АудитИзменения`)](efs_audit.html)):

* `AuditSession` – сведения о сессиях пользователей (аналогичный класс использовался ранее (`Аудит_Сессия`), '''на настоящий момент таблица не используется'''):
** `StartTime` – время начала сессии (например, «10.02.2013 16:00:23:123»).
** `EndTime` – время окончания сессии (например, «10.02.2013 17:03:27:125»).
** `LastActionTime` – время последнего аудируемого действия (например, «10.02.2013 16:30:23:123»).
** `Source` – компьютер, откуда был произведён вход в приложение (например, «IP: 192.168.0.5»).
** `Enabled` – активна ли сессия в настоящий момент (например, «false»).
** `Duration` – продолжительность сессии (вычисляется, исходя из начала и окончания сессии; например, «0.01:03:04:002»)

## Данные таблицы AuditField

* [Мастера](fd_master-association.html) находятся на том же уровне, что и собственные поля. 
Полем считается название мастера; старое и новое значения формируются в виде строки по заданному для аудита представлению. 
Старое и новое значение первичного ключа мастера записывается отдельной строкой и ему в качестве MainChange записывается запись об изменении мастера (отображаться изменение первичного ключа будет только если в классе наличествует соответствующая настройка).
* [Детейлы](fo_detail-associations-properties.html) отображаются аналогично мастерам, только имена полей задаются по типу <ИмяКласса(номер)> (аналогично было сделано в [старом аудите](efs_audit.html)).

## Применение таблиц подсистемы полномочий

* Интеграция с элементами системы полномочий позволит избежать хранения данных о пользователях системы в нескольких местах в разных форматах, [как было ранее](efs_audit.html). 
* Использование таблиц подсистемы полномочий позволит хранить в одной БД информацию подсистемы полномочий и аудита.
* Аналогичная структура собираемых данных позволит при необходимости проводить их интеграцию с расположенными в другой БД данными [подсистемы полномочий](efs_security.html) (либо просто добавить недостающие таблицы в БД аудита, если необходимо хранить данные подсистемы полномочий в той же БД).

# Формы аудита

Для отображения данных аудита в такой структуре существуют специальные [win](efs_audit-win-forms.html) и [web-формы](fa_audit-web-forms.html).

Различают 2 вида форм: записеориентированные и объектноориентированные.

'''Записеориентированные формы''' отображают информацию по записям аудита.

'''Объектноориентированные формы''' отображают информацию по аудиту объекта в целом.

![](/images/pages/img/page/AuditDataStorage/AuditForms.png)
